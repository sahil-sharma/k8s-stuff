---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: keycloak-db
  namespace: postgres
spec:
  instances: 1
  imageName: ghcr.io/cloudnative-pg/postgresql:16
  bootstrap:
    initdb:
      database: keycloak_db
      owner: keycloak_admin
      secret:
        name: kc-db-secret
  storage:
    storageClass: standard
    size: 1Gi
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: backstage-db
  namespace: postgres
spec:
  instances: 1
  imageName: ghcr.io/cloudnative-pg/postgresql:16
  bootstrap:
    initdb:
      database: backstage
      owner: backstage_admin
      secret:
        name: backstage-db-secret
      postInitSQL:
        - GRANT USAGE, CREATE ON SCHEMA public TO backstage_admin;
        - ALTER USER backstage_admin CREATEDB;
  storage:
    storageClass: standard
    size: 1Gi
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: grafana-db
  namespace: postgres
spec:
  instances: 1
  imageName: ghcr.io/cloudnative-pg/postgresql:16
  bootstrap:
    initdb:
      database: grafana_db
      owner: grafana_admin
      secret:
        name: grafana-db-secret
      postInitSQL:
        - GRANT USAGE, CREATE ON SCHEMA public TO grafana_admin;
        - ALTER USER grafana_admin CREATEDB;
  storage:
    storageClass: standard
    size: 1Gi
---